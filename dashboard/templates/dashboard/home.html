{% extends 'base.html' %}
{% block content %}

<div class="p-6 space-y-10">

  <!-- ğŸŒ… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ÙŠØ© -->
  <div id="greetingCard"
       class="relative overflow-hidden rounded-3xl border border-gray-200 shadow bg-gradient-to-r from-blue-50 to-blue-100 p-6 flex items-center justify-between transition-all duration-500">

    <div class="space-y-1">
      <h1 id="greetingText" class="text-2xl font-bold text-gray-800">
        Ù…Ø±Ø­Ø¨Ø§Ù‹ {{ request.user.first_name|default:request.user.username }} ğŸ‘‹
      </h1>
      <p id="dateText" class="text-gray-600"></p>
      <p class="text-gray-500 text-sm italic mt-1" id="quoteText">
        Ù†ØªÙ…Ù†Ù‰ Ù„Ùƒ ÙŠÙˆÙ…Ø§Ù‹ Ù…Ø«Ù…Ø±Ù‹Ø§ ÙÙŠ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹ÙŠØ§Ø¯Ø© ğŸ‘¨â€âš•ï¸
      </p>
    </div>

    <div id="iconArea" class="text-6xl text-yellow-400 transition-transform duration-500">â˜€ï¸</div>
  </div>

  <!-- ğŸ“Š Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª -->
  <div class="grid grid-cols-1 md:grid-cols-4 gap-5">
    <div class="bg-white border border-gray-200 shadow rounded-2xl p-5 hover:shadow-lg transition">
      <p class="text-sm text-gray-500 mb-1">ğŸ‘¨â€âš•ï¸ Ø§Ù„Ù…Ø±Ø¶Ù‰</p>
      <h2 class="text-3xl font-bold text-blue-700">{{ total_patients }}</h2>
      <p class="text-xs text-gray-500 mt-1">+{{ today_patients }} Ø§Ù„ÙŠÙˆÙ…</p>
    </div>

    <div class="bg-white border border-gray-200 shadow rounded-2xl p-5 hover:shadow-lg transition">
      <p class="text-sm text-gray-500 mb-1">ğŸ“… Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯</p>
      <h2 class="text-3xl font-bold text-emerald-700">{{ total_appointments }}</h2>
      <p class="text-xs text-gray-500 mt-1">+{{ recent_appointments }} Ø¢Ø®Ø± 24 Ø³Ø§Ø¹Ø©</p>
    </div>

    <div class="bg-white border border-gray-200 shadow rounded-2xl p-5 hover:shadow-lg transition">
      <p class="text-sm text-gray-500 mb-1">ğŸ’° Ø§Ù„ÙÙˆØ§ØªÙŠØ±</p>
      <h2 class="text-3xl font-bold text-green-700">{{ total_invoices|floatformat:0 }} IQD</h2>
      <p class="text-xs text-gray-500 mt-1">+{{ this_week_invoices|floatformat:0 }} Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</p>
    </div>

    <div class="bg-white border border-gray-200 shadow rounded-2xl p-5 hover:shadow-lg transition">
      <p class="text-sm text-gray-500 mb-1">ğŸ‘¥ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ†</p>
      <h2 class="text-3xl font-bold text-indigo-700">{{ users_count }}</h2>
      <p class="text-xs text-gray-500 mt-1">Ø§Ù„Ù…Ø³Ø¬Ù„ÙˆÙ† ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…</p>
    </div>
  </div>

  <!-- ğŸ§¾ Ø¢Ø®Ø± Ø§Ù„Ù…Ø±Ø¶Ù‰ -->
  <div class="bg-white rounded-2xl shadow border border-gray-200 mt-8">
    <div class="flex justify-between items-center border-b px-6 py-3 bg-gray-50">
      <h2 class="font-semibold text-gray-700">ğŸ§¾ Ø¢Ø®Ø± Ø§Ù„Ù…Ø±Ø¶Ù‰ Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ†</h2>
      <a href="{% url 'patients:list' %}" class="text-blue-600 text-sm hover:underline">Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„</a>
    </div>

    <table class="min-w-full text-sm text-left">
      <thead class="bg-gray-100 text-gray-700 uppercase text-xs">
        <tr>
          <th class="px-6 py-3">Ø§Ù„Ø§Ø³Ù…</th>
          <th class="px-6 py-3">Ø§Ù„Ø¹Ù…Ø±</th>
          <th class="px-6 py-3">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„</th>
          <th class="px-6 py-3 text-right">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</th>
        </tr>
      </thead>
      <tbody>
        {% for p in recent_patients %}
        <tr class="border-b hover:bg-gray-50 transition">
          <td class="px-6 py-3">{{ p.name }}</td>
          <td class="px-6 py-3">{{ p.age }}</td>
          <td class="px-6 py-3">{{ p.created_at|date:"d F Y" }}</td>
          <td class="px-6 py-3 text-right">
            <a href="{% url 'patients:detail' p.id %}" class="text-blue-600 hover:underline">Ø¹Ø±Ø¶</a>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="4" class="text-center py-6 text-gray-500">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø±Ø¶Ù‰ Ø¨Ø¹Ø¯</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<!-- ğŸŒ Ø³ÙƒØ±ÙŠØ¨Øª Ø§Ù„ØªØ±Ø­ÙŠØ¨ -->
<script>
  function updateGreeting() {
    const now = new Date();
    const hour = now.getHours();
    const minutes = now.getMinutes().toString().padStart(2, '0');

    const isMorning = hour >= 5 && hour < 12;
    const isEvening = hour >= 18 || hour < 5;

    const greetingText = document.getElementById("greetingText");
    const dateText = document.getElementById("dateText");
    const iconArea = document.getElementById("iconArea");
    const quoteText = document.getElementById("quoteText");
    const card = document.getElementById("greetingCard");

    const days = ["Ø§Ù„Ø£Ø­Ø¯", "Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†", "Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡", "Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡", "Ø§Ù„Ø®Ù…ÙŠØ³", "Ø§Ù„Ø¬Ù…Ø¹Ø©", "Ø§Ù„Ø³Ø¨Øª"];
    const months = ["ÙŠÙ†Ø§ÙŠØ±", "ÙØ¨Ø±Ø§ÙŠØ±", "Ù…Ø§Ø±Ø³", "Ø£Ø¨Ø±ÙŠÙ„", "Ù…Ø§ÙŠÙˆ", "ÙŠÙˆÙ†ÙŠÙˆ", "ÙŠÙˆÙ„ÙŠÙˆ", "Ø£ØºØ³Ø·Ø³", "Ø³Ø¨ØªÙ…Ø¨Ø±", "Ø£ÙƒØªÙˆØ¨Ø±", "Ù†ÙˆÙÙ…Ø¨Ø±", "Ø¯ÙŠØ³Ù…Ø¨Ø±"];

    const todayStr = `${days[now.getDay()]}ØŒ ${now.getDate()} ${months[now.getMonth()]} ${now.getFullYear()} â€” ${hour}:${minutes}`;
    dateText.textContent = todayStr;

    if (isMorning) {
      greetingText.textContent = `ğŸŒ… ØµØ¨Ø§Ø­ Ø§Ù„Ø®ÙŠØ±ØŒ {{ request.user.first_name|default:request.user.username }}!`;
      iconArea.textContent = "â˜€ï¸";
      card.className = "relative overflow-hidden rounded-3xl border border-yellow-200 shadow bg-gradient-to-r from-yellow-50 to-blue-50 p-6 flex items-center justify-between transition-all";
      quoteText.textContent = "Ù†ØªÙ…Ù†Ù‰ Ù„Ùƒ ÙŠÙˆÙ…Ù‹Ø§ Ù…Ø«Ù…Ø±Ù‹Ø§ ÙˆÙ…Ù„ÙŠØ¦Ù‹Ø§ Ø¨Ø§Ù„Ù†Ø´Ø§Ø· ğŸ‘¨â€âš•ï¸";
    } else if (isEvening) {
      greetingText.textContent = `ğŸŒ™ Ù…Ø³Ø§Ø¡ Ø§Ù„Ø®ÙŠØ±ØŒ {{ request.user.first_name|default:request.user.username }}!`;
      iconArea.textContent = "ğŸŒ™";
      card.className = "relative overflow-hidden rounded-3xl border border-gray-300 shadow bg-gradient-to-r from-blue-100 to-gray-200 p-6 flex items-center justify-between transition-all";
      quoteText.textContent = "Ù†ØªÙ…Ù†Ù‰ Ù„Ùƒ Ø£Ù…Ø³ÙŠØ© Ù‡Ø§Ø¯Ø¦Ø© Ø¨Ø¹Ø¯ ÙŠÙˆÙ… Ù…Ù„ÙŠØ¡ Ø¨Ø§Ù„Ø¹Ù…Ù„ ğŸŒ™";
    } else {
      greetingText.textContent = `ğŸ‘‹ Ø£Ù‡Ù„Ø§Ù‹ØŒ {{ request.user.first_name|default:request.user.username }}!`;
      iconArea.textContent = "â˜ï¸";
      card.className = "relative overflow-hidden rounded-3xl border border-gray-200 shadow bg-gradient-to-r from-blue-50 to-gray-50 p-6 flex items-center justify-between transition-all";
      quoteText.textContent = "Ø§Ø³ØªÙ…Ø± ÙÙŠ Ø¥Ù†Ø¬Ø§Ø²Ø§ØªÙƒ ğŸ’ª";
    }
  }

  updateGreeting();
  setInterval(updateGreeting, 60000);
</script>

{% endblock %}
