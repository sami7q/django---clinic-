{% extends 'base.html' %}
{% block content %}

<div class="p-8 space-y-10">

  <!-- 🔹 التحية -->
  <header class="flex flex-col md:flex-row md:items-center md:justify-between gap-3">
    <div>
      <h1 class="text-2xl font-bold text-gray-800">
        مرحباً {{ request.user.first_name|default:request.user.username }}
      </h1>
      <p class="text-gray-500 text-sm">نتمنى لك يوماً موفقاً في إدارة العيادة</p>
    </div>

    <a href="{% url 'appointments:create' %}"
       class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm font-medium shadow-sm">
      + إضافة موعد جديد
    </a>
  </header>

  <!-- 📊 الإحصائيات -->
  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-5">
    <div class="bg-white border border-gray-200 rounded-xl p-5 shadow-sm hover:shadow-md transition">
      <p class="text-gray-500 text-sm mb-1">المرضى</p>
      <h2 class="text-3xl font-bold text-blue-700">{{ total_patients }}</h2>
      <p class="text-xs text-gray-500 mt-1">+{{ today_patients }} اليوم</p>
    </div>

    <div class="bg-white border border-gray-200 rounded-xl p-5 shadow-sm hover:shadow-md transition">
      <p class="text-gray-500 text-sm mb-1">المواعيد</p>
      <h2 class="text-3xl font-bold text-emerald-700">{{ total_appointments }}</h2>
      <p class="text-xs text-gray-500 mt-1">+{{ recent_appointments }} خلال 24 ساعة</p>
    </div>

    <div class="bg-white border border-gray-200 rounded-xl p-5 shadow-sm hover:shadow-md transition">
      <p class="text-gray-500 text-sm mb-1">الفواتير</p>
      <h2 class="text-3xl font-bold text-green-700">{{ total_invoices|floatformat:0 }} د.ع</h2>
      <p class="text-xs text-gray-500 mt-1">+{{ this_week_invoices|floatformat:0 }} هذا الأسبوع</p>
    </div>

    <div class="bg-white border border-gray-200 rounded-xl p-5 shadow-sm hover:shadow-md transition">
      <p class="text-gray-500 text-sm mb-1">المستخدمون</p>
      <h2 class="text-3xl font-bold text-indigo-700">{{ users_count }}</h2>
      <p class="text-xs text-gray-500 mt-1">نشطون حالياً</p>
    </div>
  </div>

  <!-- ⚡ الاختصارات السريعة -->
  <section>
    <h2 class="text-lg font-semibold text-gray-800 mb-4">الاختصارات السريعة</h2>
    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4">
      <a href="{% url 'patients:create' %}" class="shortcut-btn bg-blue-50 border-blue-100 text-blue-700">مريض جديد</a>
      <a href="{% url 'appointments:create' %}" class="shortcut-btn bg-green-50 border-green-100 text-green-700">موعد جديد</a>
      <a href="{% url 'invoices:create' %}" class="shortcut-btn bg-indigo-50 border-indigo-100 text-indigo-700">فاتورة جديدة</a>
      <a href="{% url 'invoices:expense_create' %}" class="shortcut-btn bg-orange-50 border-orange-100 text-orange-700">إضافة نفقات</a>
      <a href="{% url 'patients:list' %}" class="shortcut-btn bg-gray-50 border-gray-100 text-gray-700">قائمة المرضى</a>
      <a href="{% url 'users:list' %}" class="shortcut-btn bg-cyan-50 border-cyan-100 text-cyan-700">المستخدمون</a>
    </div>
  </section>

  <!-- 🧾 آخر الأنشطة -->
  <section>
    <h2 class="text-lg font-semibold text-gray-800 mb-3">آخر الأنشطة</h2>
    <div class="space-y-2">
      {% for activity in recent_activities %}
        <div class="flex justify-between items-center bg-white border border-gray-200 rounded-xl px-4 py-2.5 shadow-sm hover:bg-gray-50 transition">
          <p class="text-sm text-gray-700">{{ activity.text }}</p>
          <p class="text-xs text-gray-500">{{ activity.date|date:"d/m/Y" }}</p>
        </div>
      {% empty %}
        <p class="text-gray-500 text-center bg-gray-50 py-3 rounded-xl border border-gray-100">
          لا توجد أنشطة حديثة
        </p>
      {% endfor %}
    </div>
  </section>

  <!-- ⏰ المواعيد القادمة -->
  <section>
    <h2 class="text-lg font-semibold text-gray-800 mb-3">المواعيد القادمة</h2>
    <div class="bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden">
      <table class="min-w-full text-sm text-gray-700">
        <thead class="bg-gray-100 text-gray-600 uppercase text-xs">
          <tr>
            <th class="px-6 py-3">المريض</th>
            <th class="px-6 py-3">التاريخ</th>
            <th class="px-6 py-3">الوقت</th>
            <th class="px-6 py-3 text-right">الحالة</th>
          </tr>
        </thead>
        <tbody>
          {% if upcoming_appointments %}
            {% for a in upcoming_appointments %}
              <tr class="border-t hover:bg-gray-50 transition">
                <td class="px-6 py-3">{{ a.patient.name }}</td>
                <td class="px-6 py-3">{{ a.date|date:"Y-m-d" }}</td>
                <td class="px-6 py-3">{{ a.time|time:"H:i" }}</td>
                <td class="px-6 py-3 text-right">
                  <span class="px-3 py-1 rounded-full text-xs font-medium 
                    {% if a.status == 'تمت الزيارة' %}bg-green-100 text-green-700
                    {% elif a.status == 'ألغيت' %}bg-red-100 text-red-700
                    {% else %}bg-blue-100 text-blue-700{% endif %}">
                    {{ a.status }}
                  </span>
                </td>
              </tr>
            {% endfor %}
          {% else %}
            <tr>
              <td colspan="4" class="text-center py-6 text-gray-500">
                لا توجد مواعيد قادمة
              </td>
            </tr>
          {% endif %}
        </tbody>
      </table>
    </div>
  </section>

</div>

<style>
.shortcut-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0.9rem 0.5rem;
  border-radius: 0.75rem;
  font-weight: 500;
  font-size: 0.875rem;
  border: 1px solid;
  transition: all 0.2s;
  box-shadow: 0 1px 2px rgba(0,0,0,0.05);
}
.shortcut-btn:hover {
  transform: translateY(-1px);
  background-color: rgba(59,130,246,0.05);
}
</style>

{% endblock %}
